<ui:composition template="/templates/pageTemplate.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:am="http://alertmonitor.io/facelets">

	<div id="contentFrame">
		<ui:define name="contentFrame">

			<h:form id="queryForm">
				<p:outputLabel value="Query: "/>
				<br/>
				<p:inputText id="queryString" value="#{uiQueryBean.query}" style="width: 90%"/>
				<p:commandButton value="Execute"  update="display" action="#{uiQueryBean.execute}" style="width: 10%"/>
				<br/>

<!--				<p:panelGrid columns="9">-->
				<p:panel>

				<p:outputLabel value="Query range"/>
				<p:toggleSwitch value="#{uiQueryBean.queryRangeEnabled}">
					<p:ajax update="queryForm, display"/>
				</p:toggleSwitch>
				</p:panel>

				<p:panel>
				<p:outputLabel for="startDateButton" value="From" rendered="#{uiQueryBean.queryRangeEnabled}"/>
				<p:datePicker id="startDateButton" value="#{uiQueryBean.startDate}" showTime="true" showIcon="true" rendered="#{uiQueryBean.queryRangeEnabled}"/>

				<p:outputLabel for="endDateButton" value="To" rendered="#{uiQueryBean.queryRangeEnabled}"/>
				<p:datePicker id="endDateButton" value="#{uiQueryBean.endDate}" showTime="true" showIcon="true" rendered="#{uiQueryBean.queryRangeEnabled}"/>


<!--				<div class="ui-inputgroup">-->
<!--					<div class="ui-inputgroup-addon"><i class="pi pi-calendar"></i></div>-->
<!--					<p:datePicker id="startDateButton2" value="#{uiQueryBean.startDate}" showTime="true" rendered="#{uiQueryBean.queryRangeEnabled}" placeholder="Start date"/>-->
<!--				</div>-->
					</p:panel>

				<p:outputLabel value="Step: " rendered="#{uiQueryBean.queryRangeEnabled}"/>
				<p:inputText value="#{uiQueryBean.step}" rendered="#{uiQueryBean.queryRangeEnabled}"/>

<!--				</p:panelGrid>-->
			</h:form>

			<hr/>

			<h:form id="display">
				<p:tag id="resultStatus" styleClass="p-mr-2" severity="danger" value="#{uiQueryBean.result}" rendered="#{uiQueryBean.result != null}"></p:tag>
				<ui:repeat var="r" value="#{uiQueryBean.queryResult}">
					<div class="card">
						<p:outputPanel deferred="true" deferredMode="visible" class="p-mt-2">
							<h5>Labels</h5>
							<p>#{r.metric}</p>
							<p:outputPanel rendered="#{r.value != null}">
								<h5>Value</h5>
								<p>#{r.value[1]} @ #{uiQueryBean.toNormalDate(r.value[0].toString())}</p>
							</p:outputPanel>
							<p:outputPanel rendered="#{r.values != null}">
								<h5>Values</h5>
								<ui:repeat var="v" value="#{r.values}">
									<p>#{v[1]} @ #{uiQueryBean.toNormalDate(v[0])}</p>
								</ui:repeat>
							</p:outputPanel>
						</p:outputPanel>
					</div>
				</ui:repeat>
			</h:form>

		</ui:define>
	</div>

</ui:composition>

